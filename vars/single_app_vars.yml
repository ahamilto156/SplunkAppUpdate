include_vars: ../splunk_vault.yml

sapp:
  - name: "{{ sapp.name }}"
    type: shared
    app_edit:
      path: "{{ ansible_user_dir }}/{{ sapp.name }}"
    app_source:
      path: "{{ splunk_home }}/etc/apps/{{ sapp.type }}/{{ sapp.name }}"
    tempfile:
      path: "/var/tmp"
      arch_name: "{{ sapp.tempfile.path }}/{{ sapp.name }}.bz2"

splunk:
  - name: splunk_app
    base_dir: /opt/splunk
    exec: "{{ splunk.based_dir }}/bin/splunk"
    admin_user: splunk
    password: "{{ vault_splunk_password }}"

retry_num: 3
retry_delay: 10

# The following is for a possible future extension:
  # If we ever wish to deploy a single local app then deployer_push_mode must be set to local
  # ATM it's default is shared and it's not changed
# tasks:
#   - name: Set deployer_push_mode if sapp.type is shared
#     set_fact:
#       deployer_push_mode: full
#     when: "{{ sapp.type }}" == shared

#    - name: Set deployer_push_mode if sapp.type is local
#     set_fact:
#       deployer_push_mode: local
#     when: "{{ sapp.type }}" == local
